"use strict";(self.webpackChunkpileum_web=self.webpackChunkpileum_web||[]).push([[8900],{54007:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>a});var t=i(74848),s=i(28453);const r={sidebar_position:2,description:"OpenID Connect Provider for Proof of Personhood"},c="PileumConnect",o={id:"connect",title:"PileumConnect",description:"OpenID Connect Provider for Proof of Personhood",source:"@site/docs/connect.md",sourceDirName:".",slug:"/connect",permalink:"/docs/connect",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,description:"OpenID Connect Provider for Proof of Personhood"},sidebar:"docsSidebar",previous:{title:"Introduction",permalink:"/docs/intro"},next:{title:"Pileus",permalink:"/docs/pileus"}},d={},a=[{value:"Overview",id:"overview",level:2},{value:"User verification procedure",id:"user-verification-procedure",level:2},{value:"FAQ",id:"faq",level:2},{value:"Is this service affiliated with the government ?",id:"is-this-service-affiliated-with-the-government-",level:3},{value:"How is processed my identity attestation ?",id:"how-is-processed-my-identity-attestation-",level:3},{value:"Why is this service not offered on-chain (i.e. as a smart contract) ?",id:"why-is-this-service-not-offered-on-chain-ie-as-a-smart-contract-",level:3},{value:"How to recover my account ?",id:"how-to-recover-my-account-",level:3},{value:"Why going through the verification procedure every year ?",id:"why-going-through-the-verification-procedure-every-year-",level:3},{value:"Developers (OIDC RP)",id:"developers-oidc-rp",level:2},{value:"Authentication Request",id:"authentication-request",level:3},{value:"Authentication Response",id:"authentication-response",level:3},{value:"Web3 : EIP-712",id:"web3--eip-712",level:3},{value:"Authentication Request",id:"authentication-request-1",level:4},{value:"Authentication Response",id:"authentication-response-1",level:4},{value:"EIP712 signature verification",id:"eip712-signature-verification",level:4}];function l(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"pileumconnect",children:"PileumConnect"})}),"\n",(0,t.jsxs)(n.p,{children:["\ud83c\udf10 ",(0,t.jsx)(n.a,{href:"https://connect.pileum.eu",children:"https://connect.pileum.eu"})]}),"\n",(0,t.jsxs)(n.admonition,{type:"note",children:[(0,t.jsx)(n.p,{children:"Users willing to use this service need :"}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Mobile application ",(0,t.jsx)(n.a,{href:"https://france-identite.gouv.fr/",children:"FranceIdentit\xe9"})," for ",(0,t.jsx)(n.a,{href:"https://play.google.com/store/apps/details?id=fr.gouv.franceidentite",children:"Android"})," or ",(0,t.jsx)(n.a,{href:"https://apps.apple.com/us/app/france-identit%C3%A9/id1590142959",children:"iPhone"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"French electronic national identity card :"}),"\n"]}),(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.img,{alt:"CNIe front",src:i(82670).A+"",width:"200",height:"127"}),"\n",(0,t.jsx)(n.img,{alt:"CNIe back",src:i(69802).A+"",width:"200",height:"125"})]})]}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://connect.pileum.eu",children:"PileumConnect"})," is a public ",(0,t.jsx)(n.code,{children:"OpenID Connect Provider"})," designed for proof of personhood & privacy."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"Users"})," must own a french electronic national identity card to register an account and prove their identity.\nThe user's identity is processed directly in the browser, ensuring it is never transmitted over the internet. Accounts must be re-verified every year."]}),"\n",(0,t.jsxs)(n.p,{children:["Any ",(0,t.jsx)(n.code,{children:"OpenID Connect Relying Party"})," can use the service to authenticate its users : the only user information provided is a ",(0,t.jsx)(n.em,{children:"Pairwise Pseudonymous Identifier"})," (PPID). PPID is the identifier of an ",(0,t.jsx)(n.code,{children:"User"})," to a ",(0,t.jsx)(n.code,{children:"Relying Party"})," that cannot be correlated with the ",(0,t.jsx)(n.code,{children:"User"}),"'s PPID at another ",(0,t.jsx)(n.code,{children:"Relying Party"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"user-verification-procedure",children:"User verification procedure"}),"\n",(0,t.jsxs)(n.p,{children:["Users must provide an identity attestation (which is PDF file) electronically-signed by the french government.\nThis PDF is processed in the browser, and a ",(0,t.jsx)(n.a,{href:"https://github.com/pileum-eu/pileum-connect-circuit",children:"Zero Knowledge proof"})," is created to prove personhood to PileumConnect, without disclosing user identity."]}),"\n",(0,t.jsx)(n.h2,{id:"faq",children:"FAQ"}),"\n",(0,t.jsx)(n.h3,{id:"is-this-service-affiliated-with-the-government-",children:"Is this service affiliated with the government ?"}),"\n",(0,t.jsx)(n.p,{children:"No."}),"\n",(0,t.jsx)(n.h3,{id:"how-is-processed-my-identity-attestation-",children:"How is processed my identity attestation ?"}),"\n",(0,t.jsx)(n.p,{children:"Your identity (extracted from the PDF attestation file) is never transmitted over the Internet. Instead, your core identity (names, birth date, birth place) is processed directly in your browser to produce a unique identifier."}),"\n",(0,t.jsxs)(n.p,{children:["On our end, we only store the association between your ",(0,t.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/WebAuthn",children:"passkey"})," and your identifier."]}),"\n",(0,t.jsx)(n.h3,{id:"why-is-this-service-not-offered-on-chain-ie-as-a-smart-contract-",children:"Why is this service not offered on-chain (i.e. as a smart contract) ?"}),"\n",(0,t.jsxs)(n.p,{children:["For privacy reason : an attacker could brute-force identifiers published on-chain to reveal real identities.\nWe made ",(0,t.jsx)(n.a,{href:"https://github.com/france-connect/sources/pull/7",children:"multiple attempts"})," at the issuer level advocating for changes that would allow a full on-chain solution, but no luck so far."]}),"\n",(0,t.jsx)(n.h3,{id:"how-to-recover-my-account-",children:"How to recover my account ?"}),"\n",(0,t.jsx)(n.p,{children:"You can recover your account by going through the verification procedure again."}),"\n",(0,t.jsx)(n.h3,{id:"why-going-through-the-verification-procedure-every-year-",children:"Why going through the verification procedure every year ?"}),"\n",(0,t.jsx)(n.p,{children:"To ensure that you still exist down here."}),"\n",(0,t.jsx)(n.h2,{id:"developers-oidc-rp",children:"Developers (OIDC RP)"}),"\n",(0,t.jsxs)(n.p,{children:["Any ",(0,t.jsx)(n.code,{children:"Relying Party"})," can rely on PileumConnect to authenticate its users. Current service configuration is available at :"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://connect.pileum.eu/.well-known/openid-configuration",children:"https://connect.pileum.eu/.well-known/openid-configuration"})}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["The only supported OIDC mode is ",(0,t.jsx)(n.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html#ImplicitFlowAuth",children:"Implicit flow"}),", with the following parameters :"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"response_type"}),": ",(0,t.jsx)(n.strong,{children:"id_token"})," or ",(0,t.jsx)(n.a,{href:"#web3--eip-712",children:(0,t.jsx)(n.strong,{children:"eip712"})})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"scope"}),": ",(0,t.jsx)(n.strong,{children:"openid"})]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"authentication-request",children:"Authentication Request"}),"\n",(0,t.jsxs)(n.p,{children:["When the RP wishes to Authenticate the End-User, the Client prepares an Authentication Request to be sent to the Authorization Endpoint.\nThis request uses the ",(0,t.jsx)(n.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html#ImplicitFlowAuth",children:"Implicit flow"})," with the following parameters:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",metastring:'title="GET https://connect.pileum.eu/api/auth?"',children:"client_id=5eb4e6846e1e31c668486dec12762dc2e406398bb5d14bef329fff4a9ce95b75\n&response_type=id_token\n&redirect_uri=https%3A%2F%2Frelying-party.fr%2Fcallback\n&scope=openid\n&state=c3a7fbe63294f6f4fedce7dc5fa29b3c\n&nonce=1be0695758d9ad41e676865558739b35\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"client_id"}),": SHA256 hash of ",(0,t.jsx)(n.code,{children:"redirect_uri"})," ",(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/URL/hostname",children:"hostname"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"authentication-response",children:"Authentication Response"}),"\n",(0,t.jsxs)(n.p,{children:["If the End-User authenticates successfully & grants the request, the Client is redirected to ",(0,t.jsx)(n.code,{children:"redirect_uri"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",metastring:'title="GET https://relying-party.fr/callback?"',children:"state=c3a7fbe63294f6f4fedce7dc5fa29b3c\n&id_token=eyJhbGciOiJ[...]\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Parameter ",(0,t.jsx)(n.code,{children:"id_token"})," is a ",(0,t.jsx)(n.a,{href:"https://jwt.io/introduction",children:"JSON Web Token (JWT)"})," signed with ",(0,t.jsx)(n.strong,{children:"ES256"})," :"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",metastring:'title="id_token:JWT"',children:'{\n   "alg" : "ES256",\n   "kid" : "oidc"\n}\n{\n   "aud" : "5eb4e6846e1e31c668486dec12762dc2e406398bb5d14bef329fff4a9ce95b75",\n   "exp" : 1708482941,\n   "iat" : 1708396549,\n   "iss" : "https://connect.pileum.eu",\n   "nonce" : "1be0695758d9ad41e676865558739b35",\n   "sub" : "aade285ad68dba3bc48a1e129e3992b5fb52e6e84480eb69107adce256277acc"\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Property ",(0,t.jsx)(n.code,{children:"sub"})," is the ",(0,t.jsx)(n.strong,{children:"PPID"}),", derived from ",(0,t.jsx)(n.code,{children:"redirect_uri"})," ",(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/URL/hostname",children:"hostname"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"web3--eip-712",children:"Web3 : EIP-712"}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsx)(n.p,{children:"This feature is custom and is not supported by the OpenID Connect specifications."})}),"\n",(0,t.jsxs)(n.p,{children:["If the ",(0,t.jsx)(n.code,{children:"Relying Party"})," is a Smart Contract, ",(0,t.jsx)(n.em,{children:"response_type"}),"=",(0,t.jsx)(n.strong,{children:"eip712"})," may be preferred. With this option,\nthe returned ",(0,t.jsx)(n.code,{children:"id_token"})," is an ",(0,t.jsx)(n.a,{href:"https://eips.ethereum.org/EIPS/eip-712",children:"EIP-712 structure"}),"."]}),"\n",(0,t.jsx)(n.h4,{id:"authentication-request-1",children:"Authentication Request"}),"\n",(0,t.jsxs)(n.p,{children:["When using ",(0,t.jsx)(n.em,{children:"response_type"}),"=",(0,t.jsx)(n.strong,{children:"eip712"}),", parameter ",(0,t.jsx)(n.code,{children:"client_id"})," must be a JSON object encoded in Base64-URL, with the following fields :"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",metastring:'title="client_id for response_type=eip712"',children:'{\n   "name" : "MySmartContract",\n   "version" : "1",\n   "chainId" : 31337,\n   "contract" : "0x5fbdb2315678afecb367f032d93f642f64180aa3",\n   "account" : "0x7A997970C01813dc3A010C7d01b50e0d17dc79C0",\n   "scope" : "0xe78222479cb676528ed8a36f9fd71706a3aaea59040e64d97aa910994897fe3e"\n}\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"name"}),", ",(0,t.jsx)(n.code,{children:"version"}),", ",(0,t.jsx)(n.code,{children:"chainId"})," and ",(0,t.jsx)(n.code,{children:"contract"})," fields are part of ",(0,t.jsx)(n.a,{href:"https://eips.ethereum.org/EIPS/eip-712#definition-of-domainseparator",children:"EIP712Domain"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"account"}),": EOA address of user that is being authenticated."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"scope"}),": hex-encoded ",(0,t.jsx)(n.em,{children:"uint256"})," value, used to further differentiate the ",(0,t.jsx)(n.code,{children:"sub"})," by associating it with a specific ",(0,t.jsx)(n.code,{children:"scope"}),", enhancing privacy and segregation of ",(0,t.jsx)(n.em,{children:"PPID"})," across different scopes within the same EIP712Domain."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"authentication-response-1",children:"Authentication Response"}),"\n",(0,t.jsxs)(n.p,{children:["If user authenticates successfully, the Client is redirected to ",(0,t.jsx)(n.code,{children:"redirect_uri"}),". Field ",(0,t.jsx)(n.code,{children:"id_token"})," is a JSON object encoded in Base64-URL :"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",metastring:'title="id_token for response_type=eip712"',children:'{\n   "account" : "0x7A997970C01813dc3A010C7d01b50e0d17dc79C0",\n   "sub" : "0xb60ae5311a0d065e60c2386ef4c81edddc24fa687503e35d297dc1d1ff704cfe",\n   "scope" : "0xe78222479cb676528ed8a36f9fd71706a3aaea59040e64d97aa910994897fe3e",\n   "nonce" : "0x1",\n   "iat" : 1708984962,\n   "exp" : 1740281565,\n   "v" : 27\n   "r" : "0x075bc5c4ca57b9dd18331654cb97d5ad03e6aca6bc68ff5cbdf9ba3c2afdb060",\n   "s" : "0xcdd7697eb7d4567c134dff02a81bc29395e5c8c0786c27d544126c104d3e39fe",\n}\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"account"}),": EOA address of user that is being authenticated."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"sub"}),": the ",(0,t.jsx)(n.strong,{children:"PPID"}),", derived from EIP712Domain and ",(0,t.jsx)(n.code,{children:"scope"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"scope"}),": hex-encoded ",(0,t.jsx)(n.em,{children:"uint256"})," value, used to further differentiate the ",(0,t.jsx)(n.code,{children:"sub"})," by associating it with a specific ",(0,t.jsx)(n.code,{children:"scope"})," within the same EIP712Domain."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"nonce"}),": value provided in the initial OIDC authorization request."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"iat"}),": UTC timestamp (in seconds)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"exp"}),": UTC timestamp (in seconds)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"v"}),", ",(0,t.jsx)(n.code,{children:"r"}),", ",(0,t.jsx)(n.code,{children:"s"}),": EIP712 signature"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"eip712-signature-verification",children:"EIP712 signature verification"}),"\n",(0,t.jsxs)(n.p,{children:["The signed ",(0,t.jsx)(n.code,{children:"id_token"})," can be verified within a smart contract using the public key available in the ",(0,t.jsx)(n.a,{href:"https://connect.pileum.eu/.well-known/jwks",children:"JWKS"}),".\nHere's a simple example of smart contract that requires a valid EIP712 signature to mint an NFT (ERC721) :"]}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsxs)(n.p,{children:["In this example, a simple expiration check on ",(0,t.jsx)(n.code,{children:"iat"})," is used to mitigate replay attacks. For stricter scenarios, the use of ",(0,t.jsx)(n.code,{children:"nonce"})," might be required to prevent replay attacks."]})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-solidity",children:'pragma solidity ^0.8.24;\n\nimport "@openzeppelin/contracts/token/ERC721/ERC721.sol";\nimport "@openzeppelin/contracts/utils/cryptography/ECDSA.sol";\nimport "@openzeppelin/contracts/utils/cryptography/EIP712.sol";\nimport "@openzeppelin/contracts/access/Ownable.sol";\n\ncontract MySmartContract is ERC721, EIP712, Ownable {\n    string private constant TOKEN_NAME = "MySmartContract";\n    string private constant TOKEN_SYM = "MSC";\n    string private constant TOKEN_VER = "1";\n    uint256 private constant SCOPE = 1337;\n\n    bytes32 private constant PILEUMAUTH_TYPEHASH =\n        keccak256(\n            "PileumAuth(address account,uint256 sub,uint256 scope,uint256 nonce,uint128 iat,uint128 exp)"\n        );\n\n    constructor(address initialOwner) payable\n        ERC721(TOKEN_NAME, TOKEN_SYM)\n        EIP712(TOKEN_NAME, TOKEN_VER)\n        Ownable(initialOwner)\n    {}\n\n    function safeMint(\n        address account,\n        uint256 sub,\n        uint256 scope,\n        uint256 nonce,\n        uint128 iat,\n        uint128 exp,\n        uint8 v,\n        bytes32 r,\n        bytes32 s\n    ) public {\n        require(exp > iat, "Invalid expiration");\n        require(block.timestamp < iat + 3600, "Message has expired");\n        require(scope == SCOPE, "Invalid scope");\n        address signer = ECDSA.recover(\n            _hashTypedDataV4(\n                keccak256(\n                    abi.encode(PILEUMAUTH_TYPEHASH, account, sub, scope, nonce, iat, exp)\n                )\n            ),\n            v,\n            r,\n            s\n        );\n        require(signer == owner(), "Invalid signature");\n        _safeMint(account, sub);\n    }\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},69802:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/cnie-b-df52c27b9bde1e8483452d424a2f7468.png"},82670:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/cnie-f-a5030e98676d10e7b61c75efb393c79f.png"},28453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>o});var t=i(96540);const s={},r=t.createContext(s);function c(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);